shadow$provide.module$node_modules$parinfer$parinfer=function(global,require,module,exports){(function(root,factory){"function"===typeof define&&define.amd?define([],factory):"object"===typeof module&&module.exports?module.exports=factory():root.parinfer=factory()})(this,function(){function isInteger(x){return"number"===typeof x&&isFinite(x)&&Math.floor(x)===x}function parseOptions(options){options=options||{};return{cursorX:options.cursorX,cursorLine:options.cursorLine,prevCursorX:options.prevCursorX,
prevCursorLine:options.prevCursorLine,selectionStartLine:options.selectionStartLine,changes:options.changes,partialResult:options.partialResult,forceBalance:options.forceBalance,returnParens:options.returnParens}}function initialParenTrail(){return{lineNo:-999,startX:-999,endX:-999,openers:[],clamped:{startX:-999,endX:-999,openers:[]}}}function cacheErrorPos(result,errorName){var e={lineNo:result.lineNo,x:result.x,inputLineNo:result.inputLineNo,inputX:result.inputX};return result.errorPosCache[errorName]=
e}function error(result,name){var cache=result.errorPosCache[name],keyLineNo=result.partialResult?"lineNo":"inputLineNo",keyX=result.partialResult?"x":"inputX",e={parinferError:!0,name:name,message:errorMessages[name],lineNo:cache?cache[keyLineNo]:result[keyLineNo],x:cache?cache[keyX]:result[keyX]},opener=peek(result.parenStack,0);if("unmatched-close-paren"===name){if((cache=result.errorPosCache["unmatched-open-paren"])||opener)e.extra={name:"unmatched-open-paren",lineNo:cache?cache[keyLineNo]:opener[keyLineNo],
x:cache?cache[keyX]:opener[keyX]}}else"unclosed-paren"===name&&(e.lineNo=opener[keyLineNo],e.x=opener[keyX]);return e}function replaceWithinLine(result,lineNo,start,end,replace){var newLine=result.lines[lineNo];newLine=newLine.substring(0,start)+replace+newLine.substring(end);result.lines[lineNo]=newLine;replace=replace.length-(end-start);0!==replace&&result.cursorLine===lineNo&&-999!==result.cursorX&&(result.cursorX===start&&result.cursorX===end?0===result.cursorX:result.cursorX>=end)&&(result.cursorX+=
replace)}function initLine(result){result.x=0;result.lineNo++;result.indentX=-999;result.commentX=-999;result.indentDelta=0;delete result.errorPosCache["unmatched-close-paren"];delete result.errorPosCache["unmatched-open-paren"];delete result.errorPosCache["leading-close-paren"];result.trackingArgTabStop=null;result.trackingIndent=!result.isInStr}function peek(arr,idxFromBack){var maxIdx=arr.length-1;return idxFromBack>maxIdx?null:arr[maxIdx-idxFromBack]}function isCloseParen(ch){return"}"===ch||
")"===ch||"]"===ch}function isValidCloseParen(parenStack,ch){return 0===parenStack.length?!1:peek(parenStack,0).ch===MATCH_PAREN[ch]}function isWhitespace(result){var ch=result.ch;return!result.isEscaped&&(" "===ch||"  "===ch)}function isCursorRightOf(cursorX,cursorLine,x,lineNo){return cursorLine===lineNo&&-999!==x&&-999!==cursorX&&cursorX>x}function resetParenTrail(result,lineNo,x){result.parenTrail.lineNo=lineNo;result.parenTrail.startX=x;result.parenTrail.endX=x;result.parenTrail.openers=[];result.parenTrail.clamped.startX=
-999;result.parenTrail.clamped.endX=-999;result.parenTrail.clamped.openers=[]}function getParentOpenerIndex(result,indentX){var i;for(i=0;i<result.parenStack.length;i++){var opener=peek(result.parenStack,i),currOutside=opener.x<indentX,prevOutside=opener.x-opener.indentDelta<indentX-result.indentDelta,isParent=!1;prevOutside&&currOutside?isParent=!0:prevOutside||currOutside?prevOutside&&!currOutside?isParent=0===result.indentDelta?!0:!1:!prevOutside&&currOutside&&((currOutside=peek(result.parenStack,
i+1))&&currOutside.indentDelta<=opener.indentDelta?isParent=indentX+currOutside.indentDelta>opener.x?!0:!1:currOutside&&currOutside.indentDelta>opener.indentDelta?isParent=!0:result.indentDelta>opener.indentDelta&&(isParent=!0),isParent&&(opener.indentDelta=0)):isParent=!1;if(isParent)break}return i}function setMaxIndent(result,opener){if(opener){var parent=peek(result.parenStack,0);parent?parent.maxChildIndent=opener.x:result.maxIndent=opener.x}}function rememberParenTrail(result){var trail=result.parenTrail,
openers=trail.clamped.openers.concat(trail.openers);if(0<openers.length&&(trail={lineNo:trail.lineNo,startX:-999!==trail.clamped.startX?trail.clamped.startX:trail.startX,endX:0===trail.openers.length?trail.clamped.endX:trail.endX},result.parenTrails.push(trail),result.returnParens))for(result=0;result<openers.length;result++)openers[result].closer.trail=trail}function addIndent(result$jscomp$0,delta){var origIndent=result$jscomp$0.x,newIndent=origIndent+delta,i,result="";for(i=0;i<newIndent;i++)result+=
" ";replaceWithinLine(result$jscomp$0,result$jscomp$0.lineNo,0,origIndent,result);result$jscomp$0.x=newIndent;result$jscomp$0.indentX=newIndent;result$jscomp$0.indentDelta+=delta}function onIndent(result){result.indentX=result.x;result.trackingIndent=!1;if(result.quoteDanger)throw error(result,"quote-danger");if("INDENT_MODE"===result.mode){var parens="",index=getParentOpenerIndex(result,result.x),i;for(i=0;i<index;i++){var opener=result.parenStack.pop();result.parenTrail.openers.push(opener);var closeCh=
MATCH_PAREN[opener.ch];parens+=closeCh;if(result.returnParens){var x=result.parenTrail.startX+i;opener.closer.lineNo=result.parenTrail.lineNo;opener.closer.x=x;opener.closer.ch=closeCh}}-999!==result.parenTrail.lineNo&&(replaceWithinLine(result,result.parenTrail.lineNo,result.parenTrail.startX,result.parenTrail.endX,parens),result.parenTrail.endX=result.parenTrail.startX+parens.length,rememberParenTrail(result));(parens=peek(result.parenStack,0))&&parens.indentDelta!==result.indentDelta&&addIndent(result,
parens.indentDelta)}else if("PAREN_MODE"===result.mode){closeCh=parens=result.x;index=0;i=result.maxIndent;if(opener=peek(result.parenStack,0))index=opener.x+1,i=opener.maxChildIndent,opener.indentDelta!==result.indentDelta&&(closeCh+=opener.indentDelta);-999!==index&&(closeCh=Math.max(index,closeCh));-999!==i&&(closeCh=Math.min(i,closeCh));closeCh!==parens&&addIndent(result,closeCh-parens)}}function makeTabStop(result,opener){result={ch:opener.ch,x:opener.x,lineNo:opener.lineNo};null!=opener.argX&&
(result.argX=opener.argX);return result}function processChar(result,ch){result.ch=ch;result.skipChar=!1;if(result.changes&&(result.smart||"PAREN_MODE"===result.mode)){var line=result.changes[result.inputLineNo];line&&(line=line[result.inputX])&&(result.indentDelta+=line.newEndX-line.oldEndX)}if(result.trackingIndent)if(isCloseParen(result.ch)){if("INDENT_MODE"===result.mode){if(!result.forceBalance){if(result.smart)throw{leadingCloseParen:!0};result.errorPosCache["leading-close-paren"]||cacheErrorPos(result,
"leading-close-paren")}result.skipChar=!0}if("PAREN_MODE"===result.mode)if(isValidCloseParen(result.parenStack,result.ch)){line=result.cursorX;var x=result.x;if(result.cursorLine===result.lineNo&&-999!==x&&-999!==line&&line<=x)resetParenTrail(result,result.lineNo,result.x),onIndent(result);else{line=result.parenStack.pop();x=MATCH_PAREN[line.ch];if(result.returnParens){var x$jscomp$0=result.parenTrail.endX;line.closer.lineNo=result.parenTrail.lineNo;line.closer.x=x$jscomp$0;line.closer.ch=x}setMaxIndent(result,
line);x$jscomp$0=result.parenTrail.endX;replaceWithinLine(result,result.parenTrail.lineNo,x$jscomp$0,x$jscomp$0,x);result.parenTrail.endX++;result.parenTrail.openers.push(line);(line=result.parenTrails[result.parenTrails.length-1])&&line.lineNo===result.parenTrail.lineNo?(line.endX=result.parenTrail.endX,result.returnParens&&(result.parenTrail.openers[result.parenTrail.openers.length-1].closer.trail=line)):rememberParenTrail(result);result.skipChar=!0}}else if(result.smart)result.skipChar=!0;else throw error(result,
"unmatched-close-paren");}else if(";"===result.ch){line=result.parenTrail.openers.length;if("PAREN_MODE"===result.mode)for(x=0;x<line;x++)result.parenStack.push(peek(result.parenTrail.openers,x));x=getParentOpenerIndex(result,result.x);(x=peek(result.parenStack,x))&&x.indentDelta!==result.indentDelta&&addIndent(result,x.indentDelta);if("PAREN_MODE"===result.mode)for(x=0;x<line;x++)result.parenStack.pop();result.trackingIndent=!1}else"\n"!==result.ch&&" "!==result.ch&&"\t"!==result.ch&&onIndent(result);
if(result.skipChar)result.ch="";else{line=result.ch;result.isEscaped=!1;if(result.isEscaping){if(result.isEscaping=!1,result.isEscaped=!0,"\n"===result.ch){if(result.isInCode)throw error(result,"eol-backslash");result.isInComment=!1;result.ch=""}}else if("{"===line||"("===line||"["===line)result.isInCode&&(line={inputLineNo:result.inputLineNo,inputX:result.inputX,lineNo:result.lineNo,x:result.x,ch:result.ch,indentDelta:result.indentDelta,maxChildIndent:-999},result.returnParens&&(line.children=[],
line.closer={lineNo:-999,x:-999,ch:""},x=(x=peek(result.parenStack,0))?x.children:result.parens,x.push(line)),result.parenStack.push(line),result.trackingArgTabStop="space");else if(isCloseParen(line)){if(result.isInCode)if(isValidCloseParen(result.parenStack,result.ch)){line=peek(result.parenStack,0);result.returnParens&&(x=result.x,x$jscomp$0=result.ch,line.closer.lineNo=result.lineNo,line.closer.x=x,line.closer.ch=x$jscomp$0);result.parenTrail.endX=result.x+1;result.parenTrail.openers.push(line);
if(line="INDENT_MODE"===result.mode&&result.smart){line=peek(result.parenStack,0);x=(x=peek(result.parenStack,1))?x.x+1:0;x$jscomp$0=line.x;var holding=result.cursorLine===line.lineNo&&x<=result.cursorX&&result.cursorX<=x$jscomp$0;if(!result.changes&&-999!==result.prevCursorLine&&result.prevCursorLine===line.lineNo&&x<=result.prevCursorX&&result.prevCursorX<=x$jscomp$0&&!holding)throw{releaseCursorHold:!0};line=holding}line&&(line=result.parenTrail.startX,x=result.parenTrail.endX,x$jscomp$0=result.parenTrail.openers,
resetParenTrail(result,result.lineNo,result.x+1),result.parenTrail.clamped.startX=line,result.parenTrail.clamped.endX=x,result.parenTrail.clamped.openers=x$jscomp$0);result.parenStack.pop();result.trackingArgTabStop=null}else{if("PAREN_MODE"===result.mode){if(line=result.parenTrail,line=line.lineNo===result.lineNo&&line.startX===result.indentX,!result.smart||!line)throw error(result,"unmatched-close-paren");}else"INDENT_MODE"===result.mode&&!result.errorPosCache["unmatched-close-paren"]&&(cacheErrorPos(result,
"unmatched-close-paren"),line=peek(result.parenStack,0))&&(x=cacheErrorPos(result,"unmatched-open-paren"),x.inputLineNo=line.inputLineNo,x.inputX=line.inputX);result.ch=""}}else'"'===line?result.isInStr?result.isInStr=!1:result.isInComment?(result.quoteDanger=!result.quoteDanger,result.quoteDanger&&cacheErrorPos(result,"quote-danger")):(result.isInStr=!0,cacheErrorPos(result,"unclosed-quote")):";"===line?result.isInCode&&(result.isInComment=!0,result.commentX=result.x,result.trackingArgTabStop=null):
"\\"===line?result.isEscaping=!0:"\t"===line?result.isInCode&&(result.ch="  "):"\n"===line&&(result.isInComment=!1,result.ch="");line=result.ch;result.isInCode=!result.isInComment&&!result.isInStr;x=result.ch;x$jscomp$0=isCloseParen(x)&&!result.isEscaped;result.isInCode&&!isWhitespace(result)&&""!==x&&!x$jscomp$0&&resetParenTrail(result,result.lineNo,result.x+line.length);if(line=result.trackingArgTabStop)"space"===line?result.isInCode&&isWhitespace(result)&&(result.trackingArgTabStop="arg"):"arg"!==
line||isWhitespace(result)||(peek(result.parenStack,0).argX=result.x,result.trackingArgTabStop=null)}line=result.ch;ch!==line&&(replaceWithinLine(result,result.lineNo,result.x,result.x+ch.length,line),result.indentDelta-=ch.length-line.length);result.x+=line.length}function processText(text,options,mode,smart){mode={mode:mode,smart:smart,origText:text,origCursorX:-999,origCursorLine:-999,inputLines:text.split(LINE_ENDING_REGEX),inputLineNo:-1,inputX:-1,lines:[],lineNo:-1,ch:"",x:0,indentX:-999,parenStack:[],
tabStops:[],parenTrail:initialParenTrail(),parenTrails:[],returnParens:!1,parens:[],cursorX:-999,cursorLine:-999,prevCursorX:-999,prevCursorLine:-999,selectionStartLine:-999,changes:null,isInCode:!0,isEscaping:!1,isEscaped:!1,isInStr:!1,isInComment:!1,commentX:-999,quoteDanger:!1,trackingIndent:!1,skipChar:!1,success:!1,partialResult:!1,forceBalance:!1,maxIndent:-999,indentDelta:0,trackingArgTabStop:null,error:{name:null,message:null,lineNo:null,x:null,extra:{name:null,lineNo:null,x:null}},errorPosCache:{}};
if(options){isInteger(options.cursorX)&&(mode.cursorX=options.cursorX,mode.origCursorX=options.cursorX);isInteger(options.cursorLine)&&(mode.cursorLine=options.cursorLine,mode.origCursorLine=options.cursorLine);isInteger(options.prevCursorX)&&(mode.prevCursorX=options.prevCursorX);isInteger(options.prevCursorLine)&&(mode.prevCursorLine=options.prevCursorLine);isInteger(options.selectionStartLine)&&(mode.selectionStartLine=options.selectionStartLine);if(Array.isArray(options.changes)){var JSCompiler_inline_result=
options.changes;if(0===JSCompiler_inline_result.length)JSCompiler_inline_result=null;else{var lines={},line,i;for(i=0;i<JSCompiler_inline_result.length;i++){if(line=JSCompiler_inline_result[i]){var newLines=line.newText.split(LINE_ENDING_REGEX);var change=line.oldText.split(LINE_ENDING_REGEX);var newEndX=(1===newLines.length?line.x:0)+newLines[newLines.length-1].length;newLines=line.lineNo+(newLines.length-1);change={x:line.x,lineNo:line.lineNo,oldText:line.oldText,newText:line.newText,oldEndX:(1===
change.length?line.x:0)+change[change.length-1].length,newEndX:newEndX,newEndLineNo:newLines,lookupLineNo:newLines,lookupX:newEndX}}else change=void 0;(line=lines[change.lookupLineNo])||(line=lines[change.lookupLineNo]={});line[change.lookupX]=change}JSCompiler_inline_result=lines}mode.changes=JSCompiler_inline_result}"boolean"===typeof options.partialResult&&(mode.partialResult=options.partialResult);"boolean"===typeof options.forceBalance&&(mode.forceBalance=options.forceBalance);"boolean"===typeof options.returnParens&&
(mode.returnParens=options.returnParens)}try{var i$jscomp$0;for(i$jscomp$0=0;i$jscomp$0<mode.inputLines.length;i$jscomp$0++){mode.inputLineNo=i$jscomp$0;JSCompiler_inline_result=void 0;lines=mode;i=i$jscomp$0;initLine(lines);lines.lines.push(lines.inputLines[i]);line=void 0;change=lines;if((-999!==change.selectionStartLine?change.selectionStartLine:change.cursorLine)===change.lineNo){for(line=0;line<change.parenStack.length;line++)change.tabStops.push(makeTabStop(change,change.parenStack[line]));
if("PAREN_MODE"===change.mode)for(line=change.parenTrail.openers.length-1;0<=line;line--)change.tabStops.push(makeTabStop(change,change.parenTrail.openers[line]));for(line=1;line<change.tabStops.length;line++){var x=change.tabStops[line].x,prevArgX=change.tabStops[line-1].argX;null!=prevArgX&&prevArgX>=x&&delete change.tabStops[line-1].argX}}for(JSCompiler_inline_result=0;JSCompiler_inline_result<lines.inputLines[i].length;JSCompiler_inline_result++)lines.inputX=JSCompiler_inline_result,processChar(lines,
lines.inputLines[i][JSCompiler_inline_result]);processChar(lines,"\n");if(!lines.forceBalance){var cache=lines.errorPosCache["unmatched-close-paren"];if(cache&&cache.x<lines.parenTrail.startX)throw error(lines,"unmatched-close-paren");if(lines.errorPosCache["leading-close-paren"]&&lines.parenTrail.lineNo===lines.lineNo)throw error(lines,"leading-close-paren");}if(lines.lineNo===lines.parenTrail.lineNo)if(JSCompiler_inline_result=lines,JSCompiler_inline_result.isInStr)JSCompiler_inline_result.parenTrail=
initialParenTrail();else if("INDENT_MODE"===JSCompiler_inline_result.mode){lines=void 0;i=JSCompiler_inline_result;var startX=i.parenTrail.startX,endX=i.parenTrail.endX;line=i;var cursorX=i.cursorX,cursorLine=i.cursorLine;if(isCursorRightOf(cursorX,cursorLine,line.parenTrail.startX,line.lineNo)&&!isCursorRightOf(cursorX,cursorLine,line.commentX,line.lineNo)){var newStartX=Math.max(startX,i.cursorX),newEndX$jscomp$0=Math.max(endX,i.cursorX),line$jscomp$0=i.lines[i.lineNo];line=0;for(lines=startX;lines<
newStartX;lines++)isCloseParen(line$jscomp$0[lines])&&line++;var openers=i.parenTrail.openers;i.parenTrail.openers=openers.slice(line);i.parenTrail.startX=newStartX;i.parenTrail.endX=newEndX$jscomp$0;i.parenTrail.clamped.openers=openers.slice(0,line);i.parenTrail.clamped.startX=startX;i.parenTrail.clamped.endX=endX}if(JSCompiler_inline_result.parenTrail.startX!==JSCompiler_inline_result.parenTrail.endX)for(var openers$jscomp$0=JSCompiler_inline_result.parenTrail.openers;0!==openers$jscomp$0.length;)JSCompiler_inline_result.parenStack.push(openers$jscomp$0.pop())}else if("PAREN_MODE"===
JSCompiler_inline_result.mode){setMaxIndent(JSCompiler_inline_result,peek(JSCompiler_inline_result.parenTrail.openers,0));if(JSCompiler_inline_result.lineNo!==JSCompiler_inline_result.cursorLine){lines=void 0;i=JSCompiler_inline_result;var startX$jscomp$0=i.parenTrail.startX,endX$jscomp$0=i.parenTrail.endX;if(startX$jscomp$0!==endX$jscomp$0&&i.lineNo===i.parenTrail.lineNo){var line$jscomp$1=i.lines[i.lineNo];line="";change=0;for(lines=startX$jscomp$0;lines<endX$jscomp$0;lines++)isCloseParen(line$jscomp$1[lines])?
line+=line$jscomp$1[lines]:change++;0<change&&(replaceWithinLine(i,i.lineNo,startX$jscomp$0,endX$jscomp$0,line),i.parenTrail.endX-=change)}}rememberParenTrail(JSCompiler_inline_result)}}if(mode.quoteDanger)throw error(mode,"quote-danger");if(mode.isInStr)throw error(mode,"unclosed-quote");if(0!==mode.parenStack.length&&"PAREN_MODE"===mode.mode)throw error(mode,"unclosed-paren");"INDENT_MODE"===mode.mode&&(initLine(mode),onIndent(mode));mode.success=!0}catch(e){if(e.leadingCloseParen||e.releaseCursorHold)return processText(text,
options,"PAREN_MODE",smart);text=e;mode.success=!1;if(text.parinferError)delete text.parinferError,mode.error=text;else throw mode.error.name="unhandled",mode.error.message=text.stack,text;}return mode}function publicResult(result){var lineEnding=-1!==result.origText.search("\r")?"\r\n":"\n";result.success?(lineEnding={text:result.lines.join(lineEnding),cursorX:result.cursorX,cursorLine:result.cursorLine,success:!0,tabStops:result.tabStops,parenTrails:result.parenTrails},result.returnParens&&(lineEnding.parens=
result.parens)):(lineEnding={text:result.partialResult?result.lines.join(lineEnding):result.origText,cursorX:result.partialResult?result.cursorX:result.origCursorX,cursorLine:result.partialResult?result.cursorLine:result.origCursorLine,parenTrails:result.partialResult?result.parenTrails:null,success:!1,error:result.error},result.partialResult&&result.returnParens&&(lineEnding.parens=result.parens));-999===lineEnding.cursorX&&delete lineEnding.cursorX;-999===lineEnding.cursorLine&&delete lineEnding.cursorLine;
lineEnding.tabStops&&0===lineEnding.tabStops.length&&delete lineEnding.tabStops;return lineEnding}var LINE_ENDING_REGEX=/\r?\n/,MATCH_PAREN={"{":"}","}":"{","[":"]","]":"[","(":")",")":"("},errorMessages={"quote-danger":"Quotes must balanced inside comment blocks.","eol-backslash":"Line cannot end in a hanging backslash.","unclosed-quote":"String is missing a closing quote.","unclosed-paren":"Unclosed open-paren.","unmatched-close-paren":"Unmatched close-paren.","unmatched-open-paren":"Unmatched open-paren.",
"leading-close-paren":"Line cannot lead with a close-paren.",unhandled:"Unhandled error."};return{version:"3.12.0",indentMode:function(text,options){options=parseOptions(options);return publicResult(processText(text,options,"INDENT_MODE"))},parenMode:function(text,options){options=parseOptions(options);return publicResult(processText(text,options,"PAREN_MODE"))},smartMode:function(text,options){options=parseOptions(options);return publicResult(processText(text,options,"INDENT_MODE",null==options.selectionStartLine))}}})}
//# sourceMappingURL=module$node_modules$parinfer$parinfer.js.map
