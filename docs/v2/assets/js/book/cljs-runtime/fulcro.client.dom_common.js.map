{"version":3,"sources":["fulcro/client/dom_common.cljc"],"mappings":"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","names":["fulcro.client.dom-common/remove-separators","s","clojure.string/replace","fulcro.client.dom-common/get-tokens","k","cljs.core/re-seq","cljs.core/name","fulcro.client.dom-common/parse","tokens","id","p1__58189#","cljs.core.filter","cljs.core/re-matches","cljs.core/first","classes","p1__58190#","sanitized-id","cljs.core.ex_info","G__58191","cljs.core.into","cljs.core.keep","cljs.core.assoc","fulcro.client.dom-common/combined-classes","classes-seq","classes-str","clojure.string.join","cljs.core/seq","cljs.core.conj","fulcro.client.dom-common/add-kwprops-to-props","props","kw","map__58193","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","cljs.core/object?","goog.object/clone","existing-classes","goog.object/get","goog.object/set","G__58195","or__4131__auto__","fulcro.client.dom-common/tags","fulcro.client.dom-common/gen-docstring","tag","client-side?","fulcro.client.dom-common/classes->str","cljs.core.comp","cljs.core.mapcat","entry","cljs.core/Keyword","cljs.core/string?","fulcro.client.dom-common/interpret-classes","cljs.core/map?","cljs.core/contains?","new-class-strings","strcls","final-classes","cljs.core.dissoc"],"sourcesContent":["(ns fulcro.client.dom-common\n  (:refer-clojure :exclude [map meta time mask select use set symbol filter])\n  (:require\n    [clojure.string :as str]\n    #?@(:cljs ([cljsjs.react]\n                [cljsjs.react.dom]\n                [goog.object :as gobj]))))\n\n(defn- remove-separators [s]\n  (when s\n    (str/replace s #\"^[.#]\" \"\")))\n\n(defn- get-tokens [k]\n  (re-seq #\"[#.]?[^#.]+\" (name k)))\n\n(defn- parse\n  \"Parse CSS shorthand keyword and return map of id/classes.\n\n  (parse :.klass3#some-id.klass1.klass2)\n  => {:id        \\\"some-id\\\"\n      :classes [\\\"klass3\\\" \\\"klass1\\\" \\\"klass2\\\"]}\"\n  [k]\n  (if k\n    (let [tokens       (get-tokens k)\n          id           (->> tokens (clojure.core/filter #(re-matches #\"^#.*\" %)) first)\n          classes      (->> tokens (clojure.core/filter #(re-matches #\"^\\..*\" %)))\n          sanitized-id (remove-separators id)]\n      (when-not (re-matches #\"^(\\.[^.#]+|#[^.#]+)+$\" (name k))\n        (throw (ex-info \"Invalid style keyword. It contains something other than classnames and IDs.\" {:item k})))\n      (cond-> {:classes (into []\n                          (keep remove-separators classes))}\n        sanitized-id (assoc :id sanitized-id)))\n    {}))\n\n(defn- combined-classes\n  \"Takes a sequence of classname strings and a string with existing classes. Returns a string of these properly joined.\n\n  classes-str can be nil or and empty string, and classes-seq can be nil or empty.\"\n  [classes-seq classes-str]\n  (str/join \" \" (if (seq classes-str) (conj classes-seq classes-str) classes-seq)))\n\n(defn add-kwprops-to-props\n  \"Combine a hiccup-style keyword with props that are either a JS or CLJS map.\"\n  [props kw]\n  (let [{:keys [classes id] :or {classes []}} (parse kw)]\n    (if #?(:clj false :cljs (or (nil? props) (object? props)))\n      #?(:clj  props\n         :cljs (let [props            (gobj/clone props)\n                     existing-classes (gobj/get props \"className\")]\n                 (when (seq classes) (gobj/set props \"className\" (combined-classes classes existing-classes)))\n                 (when id (gobj/set props \"id\" id))\n                 props))\n      (let [existing-classes (:className props)]\n        (cond-> (or props {})\n          (seq classes) (assoc :className (combined-classes classes existing-classes))\n          id (assoc :id id))))))\n\n(def tags '#{a abbr address altGlyph altGlyphDef altGlyphItem animate animateColor animateMotion animateTransform area\n             article aside audio b base bdi bdo big blockquote body br button canvas caption circle cite clipPath code\n             col colgroup color-profile cursor data datalist dd defs del desc details dfn dialog discard div dl dt\n             ellipse em embed feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting\n             feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur\n             feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence\n             fieldset figcaption figure filter font font-face font-face-format font-face-name font-face-src font-face-uri\n             footer foreignObject form g glyph glyphRef h1 h2 h3 h4 h5 h6 hatch hatchpath head header hkern hr html\n             i iframe image img input ins kbd keygen label legend li line linearGradient link main map mark marker mask\n             menu menuitem mesh meshgradient meshpatch meshrow meta metadata meter missing-glyph\n             mpath nav noscript object ol optgroup option output p param path pattern picture polygon polyline pre progress q radialGradient\n             rect rp rt ruby s samp script section select set small solidcolor source span stop strong style sub summary\n             sup svg switch symbol table tbody td text textPath textarea tfoot th thead time title tr track tref tspan\n             u ul unknown use var video view vkern wbr})\n\n(defn gen-docstring\n  \"Helper function for generating the docstrings for generated dom functions and\n  macros.\"\n  [tag client-side?]\n  (str \"Returns a \" (if client-side? \"React\" \"server side\")\n       \" DOM element. Can be invoked in several ways\\n\\n\"\n\n       \"These two are made equivalent at compile time\\n\"\n       \"(\" tag \" \\\"hello\\\")\\n\"\n       (str \"(\" tag \" nil \\\"hello\\\")\\n\")\n       \"\\n\"\n\n       \"These two are made equivalent at compile time\\n\"\n       \"(\" tag \" {:onClick f} \\\"hello\\\")\\n\"\n       \"(\" tag \" #js {:onClick f} \\\"hello\\\")\\n\"\n       \"\\n\"\n\n       \"There is also a shorthand for CSS id and class names\\n\"\n       \"(\" tag \" :#the-id.klass.other-klass \\\"hello\\\")\\n\"\n       \"(\" tag \" :#the-id.klass.other-klass {:onClick f} \\\"hello\\\")\"))\n\n(defn classes->str\n  [classes]\n  (str/join \" \"\n    (into []\n      (comp\n        (mapcat (fn [entry]\n                  (cond\n                    (keyword? entry) (:classes (parse entry))\n                    (string? entry) [entry])))\n        (clojure.core/filter string?))\n      classes)))\n\n(defn interpret-classes\n  \"Interprets the :classes prop, reducing any non-nil elements into :className. returns the new props with updated\n  :className and no :classes\"\n  [props]\n  (if (and (map? props) (contains? props :classes))\n    (let [new-class-strings (classes->str (:classes props))\n          strcls            (or (:className props) \"\")\n          final-classes     (str strcls \" \" new-class-strings)]\n      (-> props\n        (assoc :className final-classes)\n        (dissoc :classes)))\n    props))\n"]}